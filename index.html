<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Unsent Project - Digital Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@300;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #ff758c;
            --secondary-color: #ff7eb3;
            --bg-color: #fff0f3;
            --card-bg: #ffffff;
            --text-color: #4a4a4a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background: var(--bg-color);
            font-family: 'Quicksand', sans-serif;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        /* Background Animation */
        #background-animation { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; overflow: hidden; }
        .heart { position: absolute; bottom: -10vh; background-color: var(--primary-color); opacity: 0.6; animation: rise 8s infinite ease-in; transform: rotate(45deg); }
        .heart::before, .heart::after { content: ""; position: absolute; width: 100%; height: 100%; background-color: inherit; border-radius: 50%; }
        .heart::before { top: -50%; left: 0; }
        .heart::after { top: 0; left: -50%; }
        @keyframes rise { 0% { bottom: -10vh; opacity: 0; } 20% { opacity: 0.6; } 100% { bottom: 110vh; opacity: 0; } }

        /* Main Container */
        .container {
            background: var(--card-bg);
            width: 100%;
            max-width: 600px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        h1, h2 { font-family: 'Dancing Script', cursive; color: var(--primary-color); text-align: center; margin-bottom: 20px; }

        .input-group { margin-bottom: 15px; }
        label { font-weight: bold; color: var(--secondary-color); display: block; margin-bottom: 5px; }
        input[type="text"], textarea { width: 100%; padding: 12px; border: 2px solid #f0f0f0; border-radius: 10px; font-family: inherit; outline: none; transition: border-color 0.3s; }
        input[type="text"]:focus, textarea:focus { border-color: var(--primary-color); }
        textarea { height: 120px; resize: vertical; }

        /* Photo Grid */
        .photo-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0; }
        .frame { height: 120px; border: 2px dashed #ddd; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; overflow: hidden; position: relative; background: #fafafa; transition: all 0.3s; }
        .frame:hover { border-color: var(--secondary-color); background: #fff5f7; }
        .frame img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .frame span { font-size: 2rem; color: #ddd; }

        .btn {
            width: 100%;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white; border: none; padding: 15px; border-radius: 50px;
            font-family: 'Dancing Script', cursive; font-size: 1.3rem; cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover { transform: scale(1.02); box-shadow: 0 5px 15px rgba(255, 117, 140, 0.3); }
        .btn-secondary { background: #4a4a4a; }

        /* Public Board Styles */
        #public-board { border-top: 2px solid #ffeef1; padding-top: 30px; margin-top: 20px; }
        .board-list { max-height: 400px; overflow-y: auto; padding-right: 5px; }
        .board-list::-webkit-scrollbar { width: 6px; }
        .board-list::-webkit-scrollbar-thumb { background-color: #ffd1dc; border-radius: 10px; }
        
        .letter-card {
            background: #fff;
            border: 1px solid #ffeef1;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .letter-card:hover {
            transform: translateX(5px);
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .card-info h4 {
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            color: var(--primary-color);
            margin: 0;
        }
        .card-date {
            font-size: 0.75rem;
            color: #aaa;
            margin-top: 4px;
        }
        .read-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .empty-state {
            text-align: center;
            color: #aaa;
            font-style: italic;
            padding: 20px;
        }

        /* Find Section */
        #find-letter-section { border-top: 2px solid #ffeef1; padding-top: 30px; margin-top: 20px; }
        
        /* Letter Display (Hidden by default) */
        #letter-display {
            display: none;
            background: white;
            padding: 40px;
            border-radius: 5px;
            box-shadow: 10px 10px 0px var(--primary-color);
            margin-top: 30px;
            width: 100%;
            max-width: 600px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .music-player { margin-top: 20px; border-radius: 12px; overflow: hidden; }

        .hidden { display: none !important; }
        
        /* Checkbox Style */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--text-color);
            font-size: 0.9rem;
        }
        .checkbox-group input { width: auto; }
        .checkbox-group label { margin: 0; color: var(--text-color); cursor: pointer; font-weight: normal; }
        
        /* Toast Notification */
        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-color);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        #toast.show { opacity: 1; }
    </style>
</head>
<body>

    <div id="background-animation"></div>
    <div id="toast"></div>

    <div class="container" id="editor">
        <h1>Write Your Unsent Letter</h1>
        <div class="input-group">
            <label>Recipient's Name (To:)</label>
            <input type="text" id="recipient" placeholder="Their name (exactly as they'll type it)">
        </div>
        <div class="input-group">
            <label>Your Message</label>
            <textarea id="letter-content" placeholder="What's left unsaid?"></textarea>
        </div>
        <div class="input-group">
            <label>Song Link (Spotify or YouTube)</label>
            <input type="text" id="song-url" placeholder="Paste link here...">
        </div>

        <div class="photo-grid">
            <div class="frame" onclick="triggerUpload(0)"><span id="p0">+</span><img id="img-0"><input type="file" hidden accept="image/*" onchange="previewImage(this, 0)"></div>
            <div class="frame" onclick="triggerUpload(1)"><span id="p1">+</span><img id="img-1"><input type="file" hidden accept="image/*" onchange="previewImage(this, 1)"></div>
        </div>

        <div class="checkbox-group">
            <input type="checkbox" id="is-public" checked>
            <label for="is-public">Publish to Public Board (Visible to everyone)</label>
        </div>

        <button class="btn" onclick="saveLetter()">Seal Letter ❤️</button>
    </div>

    <div class="container" id="find-letter-section">
        <h2>Find a Letter</h2>
        <div class="input-group">
            <input type="text" id="search-name" placeholder="Enter a name to search archives...">
        </div>
        <button class="btn btn-secondary" onclick="findLetter()">Search Archives</button>
    </div>

    <!-- Public Board Section -->
    <div class="container" id="public-board">
        <h2>Public Board</h2>
        <p style="text-align: center; font-size: 0.9rem; color: #888; margin-bottom: 15px;">Letters published here are visible to the public</p>
        <div id="board-list" class="board-list">
            <div class="empty-state">No letters published yet. Be the first!</div>
        </div>
    </div>

    <div id="letter-display">
        <h3 id="display-to" style="font-family: 'Dancing Script'; font-size: 2rem; color: var(--primary-color);"></h3>
        <p id="display-text" style="line-height: 1.6; margin: 20px 0; white-space: pre-wrap;"></p>
        <div id="display-photos" class="photo-grid"></div>
        <div id="music-container" class="music-player"></div>
        <button class="btn" style="margin-top: 20px; font-size: 1rem;" onclick="goBack()">Back</button>
    </div>

    <script>
        // --- Storage Configuration ---
        const STORAGE_KEY = 'unsent_project_letters';
        let lettersData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

        // --- Initialization ---
        window.onload = function() {
            renderBoard();
        };

        // --- Editor Functions ---
        function triggerUpload(i) { 
            document.querySelectorAll('input[type="file"]')[i].click(); 
        }

        function previewImage(input, i) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.getElementById(`img-${i}`);
                    img.src = e.target.result;
                    img.style.display = 'block';
                    document.getElementById(`p${i}`).style.display = 'none';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function saveLetter() {
            const name = document.getElementById('recipient').value.trim().toLowerCase();
            const displayBrand = document.getElementById('recipient').value.trim();
            const content = document.getElementById('letter-content').value.trim();
            const song = document.getElementById('song-url').value.trim();
            const isPublic = document.getElementById('is-public').checked;

            if(!name) return alert("Please enter a recipient's name!");
            if(!content) return alert("Please write a message!");
            
            // Collect images
            const imgs = [document.getElementById('img-0').src, document.getElementById('img-1').src].filter(src => src.startsWith('data'));

            // Create Letter Object
            const newLetter = {
                id: Date.now(), // Unique ID based on timestamp
                name: name,
                displayBrand: displayBrand,
                content: content,
                song: song,
                photos: imgs,
                timestamp: new Date().toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' }),
                isPublic: isPublic
            };

            // Save to Local Storage
            try {
                lettersData.push(newLetter);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(lettersData));
                
                // Show appropriate message
                if (isPublic) {
                    showToast("Letter Sealed & Published to Public Board!");
                } else {
                    showToast("Letter Sealed (Saved privately)");
                }
                
                // Reset Form
                resetEditor();
                
                // Update Board
                renderBoard();

            } catch (e) {
                alert("Storage full! Try using smaller images or fewer photos.");
                console.error(e);
            }
        }

        function resetEditor() {
            document.getElementById('recipient').value = '';
            document.getElementById('letter-content').value = '';
            document.getElementById('song-url').value = '';
            document.getElementById('img-0').src = '';
            document.getElementById('img-1').src = '';
            document.querySelectorAll('.frame span').forEach(s => s.style.display = 'flex');
            document.querySelectorAll('.frame img').forEach(i => i.style.display = 'none');
        }

        // --- Public Board Functions ---
        function renderBoard() {
            const boardList = document.getElementById('board-list');
            boardList.innerHTML = '';

            // Filter only public letters
            const publicLetters = lettersData.filter(l => l.isPublic);

            if (publicLetters.length === 0) {
                boardList.innerHTML = '<div class="empty-state">No public letters yet.<br><small>Be the first to publish!</small></div>';
                return;
            }

            // Sort by newest first (reverse the array)
            publicLetters.reverse().forEach(letter => {
                const card = document.createElement('div');
                card.className = 'letter-card';
                card.onclick = () => openLetterFromBoard(letter.id);
                
                card.innerHTML = `
                    <div class="card-info">
                        <h4>To: ${letter.displayBrand}</h4>
                        <div class="card-date">${letter.timestamp}</div>
                    </div>
                    <button class="read-btn">Read</button>
                `;
                boardList.appendChild(card);
            });
        }

        function openLetterFromBoard(id) {
            const letter = lettersData.find(l => l.id === id);
            if(letter) displayLetter(letter);
        }

        // --- Find & Display Functions ---
        function findLetter() {
            const search = document.getElementById('search-name').value.trim().toLowerCase();
            
            // Search in local storage for private or public letters matching the name
            const matches = lettersData.filter(l => l.name === search);

            if (matches.length > 0) {
                // If multiple matches, show the most recent one
                const letter = matches[matches.length - 1]; 
                displayLetter(letter);
            } else {
                alert("No unsent letters found for this name.");
            }
        }

        function displayLetter(letter) {
            // Hide main sections
            document.getElementById('editor').classList.add('hidden');
            document.getElementById('find-letter-section').classList.add('hidden');
            document.getElementById('public-board').classList.add('hidden');
            
            // Show Display
            const display = document.getElementById('letter-display');
            display.style.display = 'block';

            document.getElementById('display-to').innerText = "To: " + letter.displayBrand;
            document.getElementById('display-text').innerText = letter.content;
            
            // Render Photos
            const photoContainer = document.getElementById('display-photos');
            photoContainer.innerHTML = '';
            letter.photos.forEach(src => {
                if(src) {
                    const img = document.createElement('img');
                    img.src = src;
                    photoContainer.appendChild(img);
                }
            });

            // Render Music
            const musicBox = document.getElementById('music-container');
            musicBox.innerHTML = '';
            if(letter.song) {
                if(letter.song.includes('spotify')) {
                    const id = letter.song.split('track/')[1]?.split('?')[0];
                    musicBox.innerHTML = `<iframe src="https://open.spotify.com/embed/track/${id}" width="100%" height="80" frameBorder="0" allow="encrypted-media"></iframe>`;
                } else if(letter.song.includes('youtube') || letter.song.includes('youtu.be')) {
                    let id = letter.song.split('v=')[1]?.split('&')[0];
                    if(!id) id = letter.song.split('youtu.be/')[1];
                    if(id) {
                        musicBox.innerHTML = `<iframe width="100%" height="200" src="https://www.youtube.com/embed/${id}" frameborder="0" allowfullscreen></iframe>`;
                    }
                }
            }
        }

        function goBack() {
            document.getElementById('letter-display').style.display = 'none';
            document.getElementById('editor').classList.remove('hidden');
            document.getElementById('find-letter-section').classList.remove('hidden');
            document.getElementById('public-board').classList.remove('hidden');
        }

        // --- Utility Functions ---
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // --- Background Animation ---
        function createHeart() {
            const heart = document.createElement('div');
            heart.classList.add('heart');
            const size = Math.random() * 20 + 10 + 'px';
            heart.style.width = size; 
            heart.style.height = size;
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.animationDuration = Math.random() * 3 + 5 + 's';
            document.getElementById('background-animation').appendChild(heart);
            setTimeout(() => heart.remove(), 8000);
        }
        setInterval(createHeart, 600);
    </script>
</body>
</html>
